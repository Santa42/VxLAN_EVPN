Во второй части цикла статей по технологии VxLAN EVPN рассмотрим маршрутизацию между VNI внутри сетевой фабрики.

Напомню, что используется топология Spine-Leaf:

![](img/Overlay_part1/underlayforl2.jpg)

В прошлой части мы добились одного широковещательного домена, построенного поверх сетевой фабрики на Nexus 9000v.
Однако это далеко не весь спектр задач, которые необходимо решить в рамках сети ЦОД. И сегодня мы рассмотрим следующую 
задачу - маршрутизация между VNI.

Для начала разберем, как просиходит маршрутизация и какие есть особенности. В конце статьи перейдем непосрдественно к настройке.

Для пониамния упростим схему и добавим еще один VNI 20000 для Host-2. В итоге получается:

![](img/Overlay_part2/vni1.jpg)

Как в таком случае можно передать трафик от одного Host к другому?

Есть два варианта:

1. На всех Leaf коммутаторах держать информацию обо всех VNI, тогда вся маршрутизация будет просиходить на первом же Leaf в сети
2. Использовать L3 VNI

Первый способ оставлю для самостоятельной практики, так как никаких сложностей в нем нет. Но будет честны, в работе он применяется очень редко. 
Сейчас разберем 2 способ, как более интересный и чуть более сложный со стороны как работы, так и настройки.

Для того, чтобы использовать L3VNI, необходимо создать новый VLAN. Проассоцировать его с новым VNI
и в результате схема работы будет представляться так:

![](img/Overlay_part2/l3vni2.jpg)

В итоге логика прохождения кадра от Host-1 о Host-2 следующая:

1. Кадр, отправленный Host-1 приходит на Leaf в VLAN 10, который проассоциирован с VNI 10000
2. Leaf проверяет где находится адрес назначения и находит его через второй Leaf коммутатор в другом VNI
3. Как только найден маршрут до адреса назначения, Leaf запаковывает кадр в заголовок с необходимым c L3VNI 99000 - и отправляет в сторону второго Leaf
4. Второй Leaf коммутатор получает данные с из L3VNI 99000. Достает изначальный кадр и переносит его в необходимый L2VNI

Результатом такой работы VxLAN убирает необходимость держать на всех Leaf коммутаторах информауиюю обо всех VNI, которые есть в сети. 

Работа между хостом и Leaf ничем не отличается от обычного подключения. Однако, посмотрим более внимательно на кадр, когда он проходит между коммутаторами:

